# MASTER_PATTERN

This Python script implements a sophisticated multi-timeframe analysis (MTFA) strategy known as the "Master Pattern," which is designed to detect market reversals after a period of manipulation or "stop-hunting."Here is a detailed analysis of the code and the strategy it implements:1. The Core Strategy: The Master PatternThe strategy is based on the idea that the market moves in three repeating phases, implemented here as a multi-timeframe approach:Phase 1 (Contraction/HTF Bias): The overall market context. In this code, this phase is implied when the price is near the Average Price (200 MA).Phase 2 (Expansion/Manipulation/Stop-Hunt): The price moves aggressively away from the mean to hunt stop-loss orders. The code uses a dynamic volatility measure (ATR) to confirm this move.Phase 3 (Profit Taking/Reversal - The LTF Entry): The sharp, confirmed reversal back toward or through the mean, which is the entry signal.2. Key Indicators and ConfigurationThe script uses three main constants to define the pattern:ConstantValuePurpose in the StrategyMA_PERIOD200Calculates the 200-period Simple Moving Average (Average_Price), which acts as the Higher Time Frame (HTF) Bias.ATR_PERIOD14Calculates the 14-period Average True Range (ATR) to measure market volatility.EXPANSION_ATR_MULTIPLIER1.5The distance (in multiples of ATR) the price must be away from the 200 MA to confirm a Phase 2 (Expansion/Stop-Hunt) low or high.CONSECUTIVE_MOMENTUM_CANDLES3The number of consecutive candles that must close in the trade direction to confirm the Phase 3 Low Time Frame (LTF) Reversal Entry.3. Detection Logic (detect_master_pattern)The core logic uses a "pattern within a pattern" approach by checking two conditions simultaneously:Phase 2 Confirmation (The Setup):The script looks back over the last 10 periods (phase_2_lookback) to find the recent price extreme.Buy Setup: Checks if the recent low (recent_low) is significantly below the 200 MA, confirming a manipulative move down (is_expansion_low).Sell Setup: Checks if the recent high (recent_high) is significantly above the 200 MA, confirming a manipulative move up (is_expansion_high).Phase 3 Confirmation (The Entry Trigger):After the setup is confirmed, the script checks for a sharp reversal in the current candle (i).Buy Momentum: Confirmed by 3 consecutive candles closing higher than the previous one (has_buy_momentum).Sell Momentum: Confirmed by 3 consecutive candles closing lower than the previous one (has_sell_momentum).Final Signal:A BUY Alert is triggered only if the expansion low was confirmed AND the buy momentum is confirmed (Expansion $\to$ Reversal).A SELL Alert is triggered only if the expansion high was confirmed AND the sell momentum is confirmed (Expansion $\to$ Reversal).4. Data Handling and VisualizationData Source: The getTVData function is configured to fetch up to 1500 bars of 1-minute data for the NIFTY index using the tvDatafeed library, demonstrating its real-world capability. It includes robust error handling and a fallback to generate_mock_data if fetching fails.Plotting: The plot_pattern function clearly visualizes the analysis:HTF Bias: The Average_Price (200 MA) is plotted as a grey dashed line.Entry Signals: Buy alerts are marked with an upward green triangle (^) and Sell alerts with a downward red triangle (v).Context: The Phase 2 Low (for buy setups) or Phase 2 High (for sell setups) is also annotated with an 'P' marker to show the extreme point where the stop-hunt occurred before the reversal signal.This draft provides a strong, well-defined foundation for a trend-reversal trading strategy. Let me know if you'd like to dive deeper into optimizing the EXPANSION_ATR_MULTIPLIER or explore how to dynamically determine the phase_2_lookback period.
